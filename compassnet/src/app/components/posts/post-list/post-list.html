<div class="page">
  <div class="header">
    <h2>Posts</h2>
    <a *ngIf="isAuthed()" class="btn primary" [routerLink]="['/posts/new']">New Post</a>
  </div>

  <div class="alert error" *ngIf="error">{{ error }}</div>

  <div *ngIf="loading" class="muted">Loadingâ€¦</div>
  <div *ngIf="!loading && posts.length === 0" class="muted">No posts yet.</div>

  <div class="grid" *ngIf="posts.length">
    <div class="card" *ngFor="let p of posts">
      <!-- media thumb -->
      <ng-container *ngIf="p.media_url">
        <img *ngIf="p.media_type === 'image'" class="thumb" [src]="p.media_url" alt="thumb" />
        <video *ngIf="p.media_type === 'video'" class="thumb" [src]="p.media_url" muted playsinline></video>
      </ng-container>

      <div class="top">
        <h3 class="title">{{ p.title }}</h3>
        <span class="id">#{{ p.id }}</span>
      </div>

      <p class="excerpt">{{ p.content }}</p>

      <div class="meta">
        by <span class="author">{{ p.author?.username || ('user ' + p.author_id) }}</span>
      </div>

      <div class="actions">
        <a class="btn" [routerLink]="['/posts', p.id]">Open</a>
        <a class="btn" *ngIf="isOwner(p)" [routerLink]="['/posts', p.id, 'edit']">Edit</a>
        <button class="btn danger" *ngIf="isOwner(p)" (click)="deletePost(p)">Delete</button>
      </div>
    </div>
  </div>
</div>
