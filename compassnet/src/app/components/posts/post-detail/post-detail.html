<div class="page" *ngIf="!loading; else loadingTpl">
  <div class="alert error" *ngIf="error">{{ error }}</div>

  <ng-container *ngIf="post as p">
    <div class="header">
      <a class="btn" [routerLink]="['/posts']">← Back</a>
      <div class="spacer"></div>
      <a class="btn" *ngIf="isOwner()" [routerLink]="['/posts', p.id, 'edit']">Edit</a>
    </div>

    <div class="card post">
      <!-- MEDIA -->
      <ng-container *ngIf="p.media_url">
        <img *ngIf="p.media_type === 'image'" class="post-media" [src]="p.media_url" alt="post media" />
        <video *ngIf="p.media_type === 'video'" class="post-media" [src]="p.media_url" controls></video>
      </ng-container>

      <div class="top">
        <h2 class="title">{{ p.title }}</h2>
        <span class="id">#{{ p.id }}</span>
      </div>

      <div class="meta">
        by <span class="author">{{ p.author?.username || ('user ' + p.author_id) }}</span>
      </div>

      <div class="content">{{ p.content }}</div>
    </div>

    <div class="comment-area">
      <app-comment-form
        *ngIf="isAuthed()"
        [postId]="p.id"
        (created)="handleCommentsChanged(listCmp)">
      </app-comment-form>

      <app-comment-list
        #listCmp
        [postId]="p.id">
      </app-comment-list>
    </div>
  </ng-container>
</div>

<ng-template #loadingTpl>
  <div class="page muted">Loading…</div>
</ng-template>
